expeditionStats: >
  SELECT e.expedition_code AS "expeditionCode", e.expedition_title AS "expeditionTitle", e.identifier as "expeditionIdentifier", u.first_name as "ownerFirstName", u.last_name as "ownerLastName", u.email as "ownerEmail" ${entityCounts}
  FROM expeditions AS e
  LEFT JOIN users AS u on e.user_id = u.id
  ${entityJoins}
  WHERE e.project_id = ${projectId} AND (e.public = true OR e.public <> ${includePrivate})
  ORDER BY lower(e.expedition_code)

singleExpeditionStats: >
  SELECT e.expedition_code AS "expeditionCode", e.expedition_title AS "expeditionTitle", e.identifier as "expeditionIdentifier" ${entityCounts}
  FROM expeditions AS e
  ${entityJoins}
  WHERE e.project_id = ${projectId} AND e.expedition_code = :expeditionCode
  ORDER BY lower(e.expedition_code)

statsEntityCounts: >
  COALESCE(${entity}.ct, 0) as "${entity}Count"

expeditionStatsEntityJoins: >
  LEFT JOIN (
    SELECT expedition_id, count(*) as ct FROM ${table} GROUP BY expedition_id
  ) AS ${entity} on ${entity}.expedition_id = e.id

projectStats: >
  SELECT
    p.id AS "projectId", p.project_title AS "projectTitle", p.description AS "description", p.public AS "public",
    pc.id AS "configId", pc.name AS "configName", pc.description AS "configDescription", pc.network_approved AS "configNetworkApproved",
    u.id AS "userId", u.username AS "username", u.email AS "email"
    ${entityCounts}
  FROM projects AS p
  LEFT JOIN users AS u on p.user_id = u.id
  LEFT JOIN project_configurations AS pc on p.config_id = pc.id
  ${entityJoins}
  WHERE (p.public = ${includePublic} OR p.id in (SELECT project_id from user_projects AS up where up.user_id = ${userId}))
  ORDER BY lower(p.project_title)

projectStatsEntityJoins: >
  LEFT JOIN (
    SELECT project_id, count(*) as ct FROM ${table} LEFT JOIN expeditions e ON e.id = ${table}.expedition_id GROUP BY e.project_id
  ) AS ${entity} on ${entity}.project_id = p.id
