# Reporting Service (GeOMe)

This document describes the reporting endpoint used to generate `report.json` for geome-configurations.

## Endpoint

- `GET /geome-db/reports/summary`

## Authentication

- Public-only reports can be fetched without a token.
- To include private/member projects, provide authentication:
  - `access_token` query param, or
  - `Authorization: Bearer <token>`

## Query Parameters

- `includePublic` (`true|false`, default `true`)
  - Include public/discoverable projects.
- `includePrivate` (`true|false`, default `true`)
  - Include private projects the user can access (project owner or project member).
  - Ignored when unauthenticated.
- `teamId` (integer, optional)
  - Filters to one team (`project_configurations.id`).
- `projectId` (integer, optional)
  - Filters to one project (`projects.id`).
- `topUsersLimit` (integer, optional, default `25`, max `500`)
  - Number of users returned in `topUsers`.
- `fieldLimit` (integer, optional)
  - Max rows returned in `fieldUsage`.

## Response Sections

- `generatedAt`: timestamp generated by API
- `networkId`: network id used for report
- `filters`: normalized filters applied
- `metricEntities`: entity mapping used for metrics
- `projectSummary`: per-project counts and team info
  - Includes:
    - `latestDataModification` (from `projects.latest_data_modification`)
    - `public`
    - `counts` (`events`, `samples`, `diagnostics`, `eventPhotos`, `samplePhotos`, `extractions`, `fastq`, `fasta`)
- `fieldUsage`: field fill-frequency across records
- `topUsers`: top submitters by entity counts

## Generate report.json

Local (Jetty on `8081`):

```bash
curl -sS "http://127.0.0.1:8081/geome-db/reports/summary?includePublic=true&includePrivate=true" > report.json
```

Production:

```bash
curl -sS "https://api.geome-db.org/geome-db/reports/summary?includePublic=true&includePrivate=true&access_token=YOUR_TOKEN" > report.json
```

Filtered example (team-scoped):

```bash
curl -sS "https://api.geome-db.org/geome-db/reports/summary?includePublic=true&includePrivate=true&teamId=321&topUsersLimit=100&access_token=YOUR_TOKEN" > report.json
```

Pretty-print:

```bash
python3 -m json.tool report.json
```

## Notes

- If `curl` prints `000` with `curl: (7)`, the server is not running on that port.
- On local startup, the root endpoint returning `403` is expected (app is up; auth is enforced).
